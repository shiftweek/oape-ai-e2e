---
name: Analyze RFE
description: Analyze RFEs and generate EPIC, user stories, and outcomes breakdown
---

# Analyze RFE

Implementation guidance for `/oape:analyze-rfe`. When invoked, execute the steps below.

## Prerequisites

- **Jira**: `JIRA_PERSONAL_TOKEN` set (and optionally `JIRA_URL`, default `https://issues.redhat.com`). If unset, prompt the user and exit.
- **Input**: RFE key (e.g. `RFE-7841`) or Jira URL. Extract key from URL if needed (e.g. `https://issues.redhat.com/browse/RFE-7841` → `RFE-7841`).
- **Optional (for Step 3 script-based context)**: GitHub CLI `gh` authenticated (`gh auth login`). Used by `gather_component_context.py` (which calls `github_pr_analyzer.py` and related scripts).

## Step 1: Fetch the RFE

1. Parse input: if it looks like a URL, extract the issue key; otherwise use as key.
2. Fetch the RFE:
   - **Preferred**: Run the script (from plugin root or skill dir):
     ```bash
     python3 plugins/oape/skills/analyze-rfe/scripts/fetch_rfe.py {issue_key}
     ```
     Script requires `JIRA_PERSONAL_TOKEN` and `pip install requests`. It prints JSON to stdout and clear errors to stderr.
   - **Alternative**: Use curl or Python requests:
     ```bash
     curl -sS -H "Authorization: Bearer $JIRA_PERSONAL_TOKEN" \
          -H "Accept: application/json" \
          "$JIRA_URL/rest/api/2/issue/{key}?fields=summary,description,components,labels,status,issuetype"
     ```
3. On 401/403/404: report clear error and exit. If token missing, show setup instructions (see script stderr or command doc).
4. Extract: key, summary, description, components, status, labels.

## Step 2: Parse RFE Content

From the description (strip Jira wiki markup), extract:
- **Nature/Description** — what is being requested
- **Current Limitation** — what doesn’t work today
- **Desired Behavior** — what should happen (bullets/paragraphs)
- **Use Case** — how customers will use it
- **Business Requirements** — impact, justification
- **Affected Components** — teams, operators (from description and Jira components)

Note missing sections; still proceed with available content.

## Step 3: Gather Workspace Context (Optional)

1. Search workspace for `**/context.md` or `**/component-context/**/context.md`.
2. For components mentioned in the RFE, try to match context files (by component name, aliases, or path).
3. Read matching files; extract Purpose, Scope, Out of Scope, Key Technical Areas, Related Components.
4. **Optional — rich context via scripts** (when no context files exist or deeper analysis is needed): Run the component-context gatherer from the skill scripts directory. It uses `fetch_rfe` data, **GitHub PR analysis** (`github_pr_analyzer.py`), repo structure, and optional operand discovery. Prerequisites: `gh` CLI authenticated (`gh auth login`). Example (use RFE-derived keywords for the component):
   ```bash
   python3 plugins/oape/skills/analyze-rfe/scripts/gather_component_context.py <component-name> --keywords "keyword1" "keyword2" -o .work/jira/analyze-rfe/<rfe-key>/component-context.md
   ```
   Use the generated markdown as "Component Context (from workspace)" in the report. If `gh` is not available or the run fails, fall back to file-based context only.
5. Use this when generating epics and stories (scope boundaries, key areas, handoffs). If none found, skip this section in the output.

## Step 4: Generate EPIC(s)

- **Count**: One epic for a single capability; 2–3 if clearly distinct (e.g. API + UI, or phased MVP then enhancements).
- **Per epic**: Summary/title, objective, scope (in/out), 3–6 acceptance criteria (outcome-focused), target users.
- Align with the RFE’s desired behavior and use case.

## Step 5: Generate User Stories

- **Format**: “As a &lt;role&gt;, I want to &lt;action&gt;, so that &lt;value&gt;.”
- **Per story**: User story text, short summary (5–10 words), 2–6 acceptance criteria (testable), outcome (value delivered).
- One story per distinct user-facing capability; right-size for one sprint.
- Map to desired behavior and (if present) workspace context key areas.

## Step 6: Define Outcomes

- For each story: 1–2 sentence outcome (customer/business value).
- Add epic-level outcome summary.

## Step 7: Output the Report

1. Emit markdown in this structure:

```markdown
# RFE Analysis: [KEY] - [Title]

## RFE Summary
| Field | Value |
|-------|-------|
| **Source** | [link] |
| **Key Capability** | ... |
| **Business Driver** | ... |
| **Affected Components** | ... |

## Component Context (from workspace)
[Only if context.md was loaded]

## EPIC(s)
### EPIC 1: [Title]
**Objective**: ...
**Scope**: In scope / Out of scope
**Acceptance Criteria**: ...

## User Stories
### Epic 1 → Story 1.1: [Title]
**User Story**: As a ... I want ... So that ...
**Acceptance Criteria**: ...
**Outcome**: ...

## Outcomes Summary
| Story | Outcome |
...
---
*Generated by `/oape:analyze-rfe` on [timestamp]*
```

2. Optionally write the same content to `.work/jira/analyze-rfe/<rfe-key>/breakdown.md` (create directory if needed).

## Error Handling

- **No token**: Explain how to create and set `JIRA_PERSONAL_TOKEN`; exit.
- **Issue not found**: Check key and permissions; exit.
- **Not RFE project**: Warn and continue.
- **Sparse RFE**: Note gaps; still produce best-effort breakdown.

## Best Practices

- Synthesize from the RFE; don’t copy-paste long blocks.
- Epics = quarter-sized; stories = sprint-sized.
- Every story has a clear outcome.
- When workspace context exists, use it to tighten scope and key areas.
